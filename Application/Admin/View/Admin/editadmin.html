<extend name="Public/base" />
<block name="content">
	<style>
		#img_show:hover{transform:scale(1.2);}
	</style>
	<!-- content start -->
  <div class="admin-content">
    <div class="admin-content-body">
      <div class="am-cf am-padding am-padding-bottom-0">
        <div class="am-fl am-cf"><strong class="am-text-primary am-text-lg">个人资料</strong> / <small>Personal information</small></div>
      </div>

      <hr/>

	    <div class="am-tabs am-margin" data-am-tabs>
		    <ul class="am-tabs-nav am-nav am-nav-tabs">
			    <li class="am-active"><a href="#tab1">基本信息</a></li>
			    <li><a href="#tab2">修改密码</a></li>
		    </ul>

		    <div class="am-tabs-bd">
			    <div class="am-tab-panel am-fade am-in am-active" id="tab1">
				    <div class="am-g">
					    <div class="am-u-sm-12 am-u-md-4 am-u-md-push-8">
						    <div class="am-panel am-panel-default">
							    <div class="am-panel-bd">
								    <div class="am-g">
									    <span style="text-align: center"><h4>修改头像</h4></span>
									    <div>
										    <div style="overflow: hidden;height: 200px">
											    <img style="display:block; margin: 25px auto;transition:all 0.5s;cursor:pointer;" src="/Upload/<?php echo $admininfo['avatar']?$admininfo['avatar']:'header/headmoren.png'?>" id="img_show" alt="头像" class="am-circle" width="150">
										    </div>
										    <div class="am-input-group" style="margin: 20px 40px">
											    <button id="saveHead" type="button" style="margin: 0 0;display: block" class="am-btn am-btn-secondary">保存头像</button>
												<span class="am-input-group-btn">
													<button type="button" class="am-btn am-btn-secondary" id="img_upload" onclick="return false;">选择头像</button>
												</span>
										    </div>
										    <input type="hidden" name="" id="image" value="">
									    </div>
								    </div>
							    </div>
						    </div>

						    <div class="am-panel am-panel-default">
							    <div class="am-panel-bd">
								    <div class="user-info">
									    <p>等级信息</p>
									    <div class="am-progress am-progress-sm">
										    <div class="am-progress-bar" style="width: 60%"></div>
									    </div>
									    <p class="user-info-order">当前等级：<strong>LV8</strong> 活跃天数：<strong>{$runTime}</strong> 距离下一级别：<strong>160</strong></p>
								    </div>
								    <div class="user-info">
									    <p>信息完善</p>
									    <div class="am-progress am-progress-sm">
										    <div class="am-progress-bar am-active am-progress-bar-success" style="width: {$admininfo['completion']}%"></div>
									    </div>
									    <p class="user-info-order">当前信息完善度：<strong>{$admininfo['completion']}</strong></p>
								    </div>
							    </div>
						    </div>
					    </div>

					    <div class="am-u-sm-12 am-u-md-8 am-u-md-pull-4">
						    <form class="am-form am-form-horizontal" id="adminInfo">
							    <div class="am-form-group">
								    <label for="username" class="am-u-sm-4 am-form-label">用户名 / UserName</label>
								    <div class="am-u-sm-8">
									    <input type="text" id="username" name="username" value="{$admininfo.username}" placeholder="用户名 / UserName">
									    <small>输入你的名字，让我们记住你。</small>
								    </div>
							    </div>

							    <div class="am-form-group">
								    <label for="realname" class="am-u-sm-4 am-form-label">真实姓名 / RealName</label>
								    <div class="am-u-sm-8">
									    <input type="text" id="realname" name="realname" value="{$admininfo.realname}" placeholder="真实姓名 / RealName">
								    </div>
							    </div>

							    <div class="am-form-group">
								    <label for="email" class="am-u-sm-4 am-form-label">电子邮件 / Email</label>
								    <div class="am-u-sm-8">
									    <input type="email" id="email" name="email" value="{$admininfo.email}" placeholder="输入你的电子邮件 / Email">
									    <small>邮箱你懂得...</small>
								    </div>
							    </div>

							    <div class="am-form-group">
								    <label for="phone" class="am-u-sm-4 am-form-label">电话 / Telephone</label>
								    <div class="am-u-sm-8">
									    <input type="tel" id="phone" name="telephone" value="{$admininfo.telephone}" placeholder="输入你的电话号码 / Telephone">
								    </div>
							    </div>

							    <div class="am-form-group">
								    <label for="user-QQ" class="am-u-sm-4 am-form-label">QQ</label>
								    <div class="am-u-sm-8">
									    <input type="number" pattern="[0-9]*" id="user-QQ" value="{$admininfo.qq}" name="qq" placeholder="输入你的QQ号码">
								    </div>
							    </div>

							    <div class="am-form-group">
								    <label for="weibo" class="am-u-sm-4 am-form-label">微博 / Twitter</label>
								    <div class="am-u-sm-8">
									    <input type="text" name="weibo" id="weibo" value="{$admininfo.weibo}" placeholder="输入你的微博 / Twitter">
								    </div>
							    </div>

							    <div class="am-form-group">
								    <label for="user-intro" class="am-u-sm-4 am-form-label">简介 / Intro</label>
								    <div class="am-u-sm-8">
									    <textarea rows="5" id="user-intro" name="synopsis">{$admininfo.synopsis}</textarea>
									    <small>250字以内写出你的一生...</small>
								    </div>
							    </div>

							    <div class="am-form-group">
								    <div class="am-u-sm-8 am-u-sm-push-4">
									    <input type="hidden" name="admin_id" value="{$Think.session.aid}">
									    <input type="submit" id="saveInfo" class="am-btn am-btn-primary" value="保存修改">
								    </div>
							    </div>
						    </form>
					    </div>
				    </div>
			    </div>

			    <div class="am-tab-panel am-fade" id="tab2">
				    <div class="am-g">
					    <div class="am-u-sm-12 am-u-md-4 am-u-md-push-8"></div>
					<div class="am-u-sm-12 am-u-md-8 am-u-md-pull-4">
					    <form class="am-form am-form-horizontal" id="cpass">
						    <div class="am-form-group">
							    <label for="oldpass" class="am-u-sm-5 am-form-label">旧密码</label>
							    <div class="am-u-sm-7">
								    <input type="text" id="oldpass" name="oldpassword" placeholder="输入你的旧密码">
							    </div>
						    </div>

						    <div class="am-form-group">
							    <label for="password" class="am-u-sm-5 am-form-label">新密码</label>
							    <div class="am-u-sm-7">
								    <input type="password" id="password" name="password" placeholder="输入你的新密码">
							    </div>
						    </div>

						    <div class="am-form-group">
							    <label for="password1" class="am-u-sm-5 am-form-label">确认新密码</label>
							    <div class="am-u-sm-7">
								    <input type="password" id="password1" name="password1" placeholder="确认你的新密码">
							    </div>
						    </div>
						    <div class="am-form-group">
							    <div class="am-u-sm-7 am-u-sm-push-5">
								    <input type="hidden" name="admin_id" value="{$Think.session.aid}">
								    <input type="submit" id="savePass" class="am-btn am-btn-primary" value="保存修改">
							    </div>
						    </div>
					    </form>
						</div>
					    </div>
			    </div>
		    </div>

    </div>

    <footer class="admin-content-footer">
      <hr>
      <p class="am-padding-left">© 2014 AllMobilize, Inc. Licensed under MIT license.</p>
    </footer>

  </div>
  <!-- content end -->
</block>
<block name="js">
	<script type="text/javascript" src="__PUBLIC__/uploadify/jquery.uploadify.min.js"></script>
	<script>
		$("#adminInfo").submit(function(){
			var data=$("#adminInfo").serializeArray();
			var postData={};
			$(data).each(function(){
				postData[this.name]=this.value;
			});
			$.post('__CONTROLLER__/saveinfo',postData,function(result){
				if(result.status==0){
					dialog.error(result.message);
				}else if(result.status==1){
					dialog.success2(result.message);
//					location.reload(true);
				}
			});
			return false;
		});

		$("#cpass").submit(function(){
			var data=$("#cpass").serializeArray();
			var postData={};
			$(data).each(function(){
				postData[this.name]=this.value;
			});
			$.post("__CONTROLLER__/changepassword",postData,function(result){
				if((result.status==0)){
					dialog.error(result.message);
				}else if(result.status==1){
					dialog.success2(result.message);
				}
			});
			return false;
		});

		$("#saveHead").click(function(){
			var data=$("#image").val();
			var postData={'avatar':data};
//			console.log(postData);
			$.post("__CONTROLLER__/saveAvatar",postData,function(result){
				if(result.status==0){
					dialog.error(result.message);
				}else if(result.status==1){
					dialog.success2(result.message);
				}
			});
		});

		/*图片上传*/
		var uploadConfig={
			'buttonClass' : 'am-btn am-btn-secondary',
			'multi' : false,
			'swf' : '__PUBLIC__/uploadify/uploadify.swf',///Public/uploadify/uploadify.swf
			'uploader' : '__MODULE__/Upload/index.html',
			'fileTypeExts' : '*.jpg;*.png',
			'fileSizeLimit' : '3MB',
			'formData' : {
				'id' : '{$Think.session.aid}',
				'avatar':1,
			},
			'onInit' : function(instance) {
				$("#img_upload").attr('style', '');
				instance.button.removeClass("uploadify-button").attr('style', '').html('选择图片');
			},
			'overrideEvents' : [ 'onSelectError', 'onDialogClose' ],
			'onSelectError' : function(file, errorCode, errorMsg) {
				switch (errorCode) {
					case -100:
						dialog.error("上传的文件数量已经超出系统限制的"
								+ $('#img_upload').uploadify('settings', 'queueSizeLimit')
								+ "个文件！");
						break;
					case -110:
						dialog.error("文件 \"" + file.name + "\" 大小超出系统限制的"
								+ $('#img_upload').uploadify('settings', 'fileSizeLimit')
								+ "大小！");
						break;
					case -120:
						dialog.error("文件 \"" + file.name + "\" 大小异常！");
						break;
					case -130:
						dialog.error("文件 \"" + file.name + "\" 类型不正确！");
						break;
					default:
						msgText += "错误代码：" + errorCode + "\n" + errorMsg;
				}
			},
			'onUploadSuccess' : function(file, data, response) {
				var code=$(data).find('code').text();
				if(code==0){
					dialog.success2('图片上传成功');
					var img=$(data).find('imgurl').text();
					$("#image").val(img);
					$("#img_show").attr('src', '{$Think.const.upload_path}'+img);
				}else{
					dialog.error($(data).find('msg').text());
				}
			}
		};
		$('#img_upload').uploadify(uploadConfig);
	</script>
</block>